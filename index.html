<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sidings Medical Practice – Average Blood Pressure Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --nhs-blue: #005eb8;
      --nhs-dark: #00395d;
      --bg-soft: #f5f7fb;
      --border-soft: #e5e7eb;
      --text-main: #111827;
      --text-muted: #4b5563;
      --radius-lg: 14px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.18);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #dce9f8 0, #f5f7fb 55%, #ffffff 100%);
      color: var(--text-main);
    }

    /* Header */
    .site-header {
      background: linear-gradient(90deg, var(--nhs-dark), var(--nhs-blue));
      color: #ffffff;
      padding: 0.85rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
    }

    .site-title {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .site-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .site-tag {
      font-size: 0.78rem;
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.25);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    /* Layout */
    .shell {
      max-width: 1080px;
      margin: 1.5rem auto 2.5rem auto;
      padding: 0 1rem;
    }

    .app {
      background: #ffffff;
      border-radius: 22px;
      box-shadow: var(--shadow-soft);
      overflow: hidden;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
      min-height: 420px;
    }

    @media (max-width: 880px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .app-main {
      padding: 1.75rem 1.75rem 1.4rem 1.75rem;
      border-right: 1px solid var(--border-soft);
    }

    @media (max-width: 880px) {
      .app-main {
        border-right: none;
        border-bottom: 1px solid var(--border-soft);
      }
    }

    .app-aside {
      padding: 1.75rem 1.75rem 1.4rem 1.75rem;
      background: linear-gradient(145deg, #f9fafb, #edf2ff);
    }

    h1 {
      margin: 0 0 0.4rem 0;
      font-size: 1.45rem;
      letter-spacing: 0.01em;
    }

    .strapline {
      margin: 0;
      color: var(--text-muted);
      font-size: 0.92rem;
    }

    .meta-line {
      margin-top: 0.45rem;
      font-size: 0.8rem;
      color: #6b7280;
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      align-items: center;
    }

    .pill {
      padding: 0.16rem 0.6rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      font-size: 0.75rem;
      border: 1px solid #dbeafe;
    }

    .pill-soft {
      background: #f3f4f6;
      color: #4b5563;
      border-color: #e5e7eb;
    }

    /* Table and inputs */
    .section-title {
      margin-top: 1.4rem;
      font-size: 0.98rem;
      font-weight: 600;
    }

    .section-help {
      margin: 0.2rem 0 0.6rem 0;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 0.5rem 0 0.75rem 0;
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
    }

    th,
    td {
      padding: 0.4rem 0.45rem;
      text-align: center;
      font-size: 0.86rem;
    }

    th {
      background: #eef2ff;
      color: #1f2937;
      font-weight: 600;
      border-bottom: 1px solid #e5e7eb;
    }

    tr:nth-child(even) td {
      background: #fdfdfd;
    }

    input[type="number"] {
      width: 90%;
      padding: 0.25rem 0.35rem;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 0.86rem;
      text-align: center;
      background: #ffffff;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: var(--nhs-blue);
      box-shadow: 0 0 0 1px rgba(0, 94, 184, 0.16);
    }

    /* Buttons */
    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-top: 0.4rem;
      margin-bottom: 0.3rem;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 0.5rem 1.25rem;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--nhs-blue), #0ea5e9);
      color: #ffffff;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.25);
    }

    .btn-primary:hover {
      filter: brightness(0.97);
    }

    .btn-ghost {
      background: #f3f4f6;
      color: #111827;
      border: 1px solid #e5e7eb;
    }

    .btn-ghost:hover {
      background: #e5e7eb;
    }

    /* Results & messages */
    .error {
      margin-top: 0.3rem;
      font-size: 0.85rem;
      color: #b91c1c;
    }

    .result-card {
      margin-top: 0.9rem;
      padding: 0.85rem 1rem;
      border-radius: 12px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }

    .result-main {
      font-size: 1.02rem;
      font-weight: 600;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: baseline;
    }

    .bp-value {
      font-size: 1.15rem;
      font-weight: 700;
    }

    .badge {
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #e0f2fe;
      color: #0369a1;
      border: 1px solid #bae6fd;
    }

    .bp-comment {
      margin-top: 0.45rem;
      font-size: 0.86rem;
      color: var(--text-muted);
    }

    /* Aside content */
    .aside-heading {
      font-size: 0.98rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .aside-text {
      font-size: 0.86rem;
      color: var(--text-muted);
      margin: 0.15rem 0;
    }

    .aside-card {
      margin-top: 0.65rem;
      padding: 0.7rem 0.75rem;
      border-radius: 10px;
      background: #ffffff;
      border: 1px solid rgba(148, 163, 184, 0.45);
    }

    .aside-card h3 {
      margin: 0 0 0.3rem 0;
      font-size: 0.9rem;
    }

    .aside-list {
      margin: 0.1rem 0;
      padding-left: 1.1rem;
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    .aside-list li {
      margin: 0.15rem 0;
    }

    .footnote {
      margin-top: 0.85rem;
      font-size: 0.78rem;
      color: #6b7280;
      border-top: 1px dashed #d1d5db;
      padding-top: 0.6rem;
    }

    .highlight {
      color: var(--nhs-blue);
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- Top bar -->
  <header class="site-header">
    <div>
      <div class="site-title">Sidings Medical Practice</div>
      <div class="site-subtitle">Boston, Lincolnshire · Internal tool</div>
    </div>
    <div class="site-tag">Hypertension · HBPM</div>
  </header>

  <main class="shell">
    <div class="app">
      <!-- Left: calculator -->
      <section class="app-main" aria-label="Average blood pressure calculator">
        <header>
          <h1>Average Blood Pressure Calculator (HBPM / multiple readings)</h1>
          <p class="strapline">
            Calculates a simple average from home or clinic readings. Hypertension is a
            modifiable cardiovascular risk factor – interpret in line with NICE NG136.
          </p>
          <div class="meta-line">
            <span class="pill">For Sidings Medical Practice staff</span>
            <span class="pill pill-soft">No data stored or transmitted · browser only</span>
          </div>
        </header>

        <div>
          <div class="section-title">Enter blood pressure readings</div>
          <p class="section-help">
            Use readings from the arm with the higher blood pressure. Enter complete
            systolic/diastolic pairs (e.g. HBPM or repeated clinic BPs). Leave unused rows blank.
          </p>

          <table id="bpTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Systolic (mmHg)</th>
                <th>Diastolic (mmHg)</th>
              </tr>
            </thead>
            <tbody>
              <!-- rows inserted by JavaScript -->
            </tbody>
          </table>

          <div class="button-row">
            <button id="calcBtn" class="btn-primary" type="button">
              ▶ Calculate average
            </button>
            <button id="addRowBtn" class="btn-ghost" type="button">
              + Add row
            </button>
            <button id="clearBtn" class="btn-ghost" type="button">
              Clear all
            </button>
          </div>

          <div id="error" class="error" aria-live="polite"></div>

          <section id="result" class="result-card" style="display: none;" aria-live="polite">
            <div class="result-main">
              <span>Average blood pressure:</span>
              <span class="bp-value">
                <span id="avgSys"></span>/<span id="avgDia"></span> mmHg
              </span>
              <span id="readingCount" class="badge"></span>
            </div>
            <p id="bpComment" class="bp-comment"></p>
          </section>
        </div>

        <p class="footnote">
          This tool gives the arithmetic mean of readings entered. It does not diagnose or
          manage hypertension. Compare the average with
          <span class="highlight">NICE NG136</span> and local Lincolnshire ICB guidance, taking
          into account overall cardiovascular risk (e.g. QRISK3), comorbidities, frailty and
          patient preference.
        </p>
      </section>

      <!-- Right: guidance / notes -->
      <aside class="app-aside">
        <div class="aside-heading">How this relates to NICE NG136</div>
        <p class="aside-text">
          For diagnosis, NICE uses average daytime ABPM or average HBPM. Clinic thresholds
          are higher than home thresholds. Use this calculator to obtain the average, then
          apply the guideline.
        </p>

        <div class="aside-card">
          <h3>HBPM / daytime ABPM diagnostic ranges</h3>
          <ul class="aside-list">
            <li><strong>&lt;135/85 mmHg</strong> – below the home/ABPM threshold used to diagnose hypertension.</li>
            <li>
              <strong>135/85–149/94 mmHg</strong> – corresponds to
              <strong>stage&nbsp;1 hypertension</strong> range for HBPM/ABPM.
            </li>
            <li>
              <strong>≥150/95 mmHg</strong> – corresponds to
              <strong>stage&nbsp;2 hypertension</strong> range for HBPM/ABPM.
            </li>
          </ul>
          <p class="aside-text">
            Diagnosis and treatment still depend on age, target organ damage, existing CVD
            and 10-year CVD risk, not numbers alone.
          </p>
        </div>

        <div class="aside-card">
          <h3>Targets when monitoring treatment (HBPM)</h3>
          <ul class="aside-list">
            <li><strong>Age &lt;80y:</strong> usually aim for average home BP below about <strong>135/85</strong>.</li>
            <li><strong>Age ≥80y:</strong> usually aim for average home BP below about <strong>145/85</strong>.</li>
          </ul>
          <p class="aside-text">
            These correspond to clinic targets of roughly &lt;140/90 and &lt;150/90. Use
            clinical judgement in frailty or multimorbidity.
          </p>
        </div>

        <div class="aside-card">
          <h3>Practical notes for Sidings</h3>
          <ul class="aside-list">
            <li>Record the calculated average and source (e.g. "7-day HBPM") in SystmOne.</li>
            <li>Do not enter identifiable data on this page (no names, DOB, NHS numbers).</li>
            <li>Remember cuff size, technique and posture when arranging HBPM/ABPM.</li>
          </ul>
        </div>

        <p class="footnote">
          Hypertension is a risk factor for cardiovascular disease, not a disease in itself.
          Reducing blood pressure and wider lifestyle risk (smoking, weight, alcohol, activity,
          salt and sodium load – including soluble medications) reduces future events.
        </p>
      </aside>
    </div>
  </main>

  <script>
    const tbody = document.querySelector("#bpTable tbody");
    const errorEl = document.getElementById("error");
    const resultCard = document.getElementById("result");
    const avgSysEl = document.getElementById("avgSys");
    const avgDiaEl = document.getElementById("avgDia");
    const readingCountEl = document.getElementById("readingCount");
    const commentEl = document.getElementById("bpComment");

    function addRow(index) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${index}</td>
        <td><input type="number" min="50" max="260" step="1" placeholder="e.g. 135" aria-label="Systolic reading ${index}"></td>
        <td><input type="number" min="30" max="160" step="1" placeholder="e.g. 82" aria-label="Diastolic reading ${index}"></td>
      `;
      tbody.appendChild(row);
    }

    function initialiseRows() {
      tbody.innerHTML = "";
      // 14 rows as a reasonable default (e.g. 7 days × 2 readings)
      for (let i = 1; i <= 14; i++) {
        addRow(i);
      }
    }

    function clearAll() {
      initialiseRows();
      errorEl.textContent = "";
      resultCard.style.display = "none";
    }

    // Classify based on NICE NG136 HBPM/ABPM diagnostic bands
    function classifyBP(sys, dia) {
      if (sys < 135 && dia < 85) {
        return "Average is below the home/ambulatory threshold typically used to diagnose hypertension. Still interpret in context of clinic readings, cardiovascular risk and target organ damage.";
      } else if ((sys >= 135 && sys <= 149) || (dia >= 85 && dia <= 94)) {
        return "Average sits in the home/ambulatory range that corresponds to stage 1 hypertension. Whether to start or intensify treatment depends on age, target organ damage, existing CVD and estimated 10-year risk.";
      } else {
        return "Average sits in the home/ambulatory range that corresponds to stage 2 hypertension. NICE usually recommends drug treatment alongside lifestyle change unless there are specific reasons not to.";
      }
    }

    function calculateAverage() {
      let sumSys = 0;
      let sumDia = 0;
      let count = 0;
      errorEl.textContent = "";

      const rows = tbody.querySelectorAll("tr");
      let hasRowError = false;

      rows.forEach((row) => {
        const inputs = row.querySelectorAll("input");
        const sysVal = inputs[0].value.trim();
        const diaVal = inputs[1].value.trim();

        if (!sysVal && !diaVal) {
          return; // ignore completely empty row
        }

        if (!sysVal || !diaVal) {
          errorEl.textContent =
            "Each used row must contain both systolic and diastolic values.";
          hasRowError = true;
          return;
        }

        const sys = Number(sysVal);
        const dia = Number(diaVal);

        if (Number.isNaN(sys) || Number.isNaN(dia) || sys <= 0 || dia <= 0) {
          errorEl.textContent =
            "Please check entries – all values must be positive numbers.";
          hasRowError = true;
          return;
        }

        sumSys += sys;
        sumDia += dia;
        count += 1;
      });

      if (hasRowError) {
        resultCard.style.display = "none";
        return;
      }

      if (count === 0) {
        errorEl.textContent =
          "Please enter at least one complete blood pressure reading before calculating.";
        resultCard.style.display = "none";
        return;
      }

      const avgSys = sumSys / count;
      const avgDia = sumDia / count;

      avgSysEl.textContent = avgSys.toFixed(1);
      avgDiaEl.textContent = avgDia.toFixed(1);
      readingCountEl.textContent = `${count} reading${count > 1 ? "s" : ""}`;
      commentEl.textContent = classifyBP(avgSys, avgDia);
      resultCard.style.display = "block";
    }

    document.getElementById("calcBtn").addEventListener("click", calculateAverage);
    document.getElementById("addRowBtn").addEventListener("click", () => {
      const currentRows = tbody.querySelectorAll("tr").length;
      addRow(currentRows + 1);
    });
    document.getElementById("clearBtn").addEventListener("click", clearAll);

    // Initialise on load
    initialiseRows();
  </script>
</body>
</html>
